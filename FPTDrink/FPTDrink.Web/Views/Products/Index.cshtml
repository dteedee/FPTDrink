@model FPTDrink.Web.ViewModels.ProductsListViewModel
@{
	ViewData["Title"] = "Sản phẩm";
	int totalPages = (int)System.Math.Ceiling((double)System.Math.Max(Model.Total, 0) / System.Math.Max(Model.PageSize, 1));
}

<div class="d-flex align-items-center justify-content-between mb-3">
	<h1 class="h4 m-0">Sản phẩm</h1>
	<form class="d-flex" method="get">
		<input type="hidden" name="categoryId" value="@Model.CategoryId" />
		<input class="form-control me-2" type="search" name="q" value="@Model.Q" placeholder="Tìm kiếm...">
		<button class="btn btn-outline-primary" type="submit">Tìm</button>
	</form>
</div>

<div class="row g-3">
	@foreach (var p in Model.Items)
	{
		<div class="col-6 col-md-3">
			<div class="card h-100 shadow-sm position-relative overflow-hidden">
				@if (p.HasDiscount)
				{
					<span class="badge bg-danger position-absolute top-0 start-0 m-2">-@p.DiscountPercent%</span>
				}
				<img class="card-img-top object-fit-cover" style="height:180px" 
				     src="@(string.IsNullOrWhiteSpace(p.Image) ? Url.Content("~/images/placeholder.png") : p.Image)" 
				     alt="@p.Title"
				     loading="lazy"
				     width="300"
				     height="180" />
				<div class="card-body d-flex flex-column">
					<h3 class="h6 card-title">@p.Title</h3>
					<div class="mt-auto">
						@if (p.HasDiscount)
						{
							<div>
								<span class="text-danger fw-bold">@string.Format("{0:N0} ₫", p.GiaHienThi)</span>
								<small class="text-muted text-decoration-line-through ms-2">@string.Format("{0:N0} ₫", p.OriginalPrice)</small>
							</div>
						}
						else
						{
							<div class="fw-bold">@string.Format("{0:N0} ₫", p.GiaHienThi)</div>
						}
						<a class="btn btn-primary btn-sm w-100 mt-2" asp-action="Detail" asp-route-id="@p.Id">Xem chi tiết</a>
					</div>
				</div>
			</div>
		</div>
	}
</div>

@if (totalPages > 1)
{
	<nav aria-label="Page navigation" class="mt-3">
		<ul class="pagination justify-content-center">
			@for (int i = 1; i <= totalPages; i++)
			{
				<li class="page-item @(i == Model.Page ? "active" : string.Empty)">
					<a class="page-link" href="@Url.Action("Index", new { page = i, pageSize = Model.PageSize, categoryId = Model.CategoryId, q = Model.Q })">@i</a>
				</li>
			}
		</ul>
	</nav>
}

@section Scripts {
	<style>
		.object-fit-cover { object-fit: cover; }
	</style>
}

