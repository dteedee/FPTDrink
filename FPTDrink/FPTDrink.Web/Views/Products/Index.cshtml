@model FPTDrink.Web.ViewModels.ProductsListViewModel
@{
	ViewData["Title"] = "Sản phẩm";
	int totalPages = (int)System.Math.Ceiling((double)System.Math.Max(Model.Total, 0) / System.Math.Max(Model.PageSize, 1));
}

<section class="products-section">
	<div class="section-header">
		<div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
			<div>
				<h2><i class="bx bx-package"></i>Sản phẩm</h2>
				<p class="mb-0">Khám phá bộ sưu tập đồ uống đa dạng của chúng tôi</p>
			</div>
	<form class="d-flex" method="get">
		<input type="hidden" name="categoryId" value="@Model.CategoryId" />
				<div class="input-group">
					<input class="form-control" type="search" name="q" value="@Model.Q" placeholder="Tìm kiếm sản phẩm...">
					<button class="btn btn-outline-primary" type="submit"><i class="bx bx-search"></i> Tìm</button>
				</div>
	</form>
		</div>
</div>

	@if (Model.Items.Count == 0)
	{
		<div class="alert alert-info text-center">
			<i class="bx bx-info-circle me-2"></i>Không tìm thấy sản phẩm nào. Vui lòng thử lại với từ khóa khác.
		</div>
	}
	else
	{
		<div class="row g-4">
	@foreach (var p in Model.Items)
	{
		<div class="col-6 col-md-3">
					<div class="product-card card h-100 shadow-sm position-relative overflow-hidden border-0">
				@if (p.HasDiscount)
				{
							<span class="badge position-absolute top-0 start-0 m-2">-@p.DiscountPercent%</span>
				}
						<a asp-action="Detail" asp-route-id="@p.Id" class="text-decoration-none">
				@{
					var imageUrl = !string.IsNullOrWhiteSpace(p.Image) 
						? ImagePathHelper.GetImageUrl(p.Image) 
						: Url.Content("~/images/placeholder.png");
				}
				<img class="card-img-top" 
				     src="@imageUrl" 
				     alt="@p.Title"
				     loading="lazy"
				     onerror="this.onerror=null; this.src='@Url.Content("~/images/placeholder.png")';" />
						</a>
				<div class="card-body d-flex flex-column">
							<h3 class="card-title text-truncate-2">@p.Title</h3>
					<div class="mt-auto">
						@if (p.HasDiscount)
						{
							<div>
										<span class="text-primary fw-bold">@string.Format("{0:N0} ₫", p.GiaHienThi)</span>
								<small class="text-muted text-decoration-line-through ms-2">@string.Format("{0:N0} ₫", p.OriginalPrice)</small>
							</div>
						}
						else
						{
									<div class="text-primary fw-bold">@string.Format("{0:N0} ₫", p.GiaHienThi)</div>
						}
								<a class="btn btn-primary btn-sm w-100 mt-2" asp-action="Detail" asp-route-id="@p.Id">
									<i class="bx bx-show me-1"></i>Xem chi tiết
								</a>
					</div>
				</div>
			</div>
		</div>
	}
</div>

@if (totalPages > 1)
{
			<nav aria-label="Page navigation" class="mt-4">
		<ul class="pagination justify-content-center">
			@for (int i = 1; i <= totalPages; i++)
			{
				<li class="page-item @(i == Model.Page ? "active" : string.Empty)">
					<a class="page-link" href="@Url.Action("Index", new { page = i, pageSize = Model.PageSize, categoryId = Model.CategoryId, q = Model.Q })">@i</a>
				</li>
			}
		</ul>
	</nav>
}
}
</section>

